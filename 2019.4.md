# 21 
1. ASP.NET Web API身份验证和授权

1.1 开发完Asp.Net WebAPI程序后，可以使用**WebHost**寄宿方式或者**SelfHost**寄宿方式来部署Asp.Net WebAPI。
    所谓WebHost寄宿就是通过Asp.Net来实现；所谓SelfHost就是可以通过控制台、WinForm、WPF等方式寄宿。
    
    * Thread.CurrentPrincipal. This property is the standard way to set the thread's principal in .NET. **WebHost**
    * HttpContext.Current.User. This property is specific to ASP.NET. **SelfHost**
    
    ```c#
    private void SetPrincipal(IPrincipal principal)
    {
        Thread.CurrentPrincipal = principal;
        if (HttpContext.Current != null)
        {
            HttpContext.Current.User = principal;
        }
    }
    ```


# 22
1. 基于角色的安全
   1.1 Principal 主体
        GenericPrincipal: 表示一般用户， 通常和GenericIdentity类一起使用。
        WindowsPrincipal: 表示windows用户，实现了Windows组成员条件映射到角色的附加功能，通常和windowsIdentity类一起使用。
        
          ```c#
          public Interface IPrincipal{
            bool IsInRole(string role);
            IIdentity Identity{get;set;}
          }
          ```
          
   1.2 Identity 标识
   
         ```c#
          public Interface IIdentity{
            string AuthenticationType{get;}
            bool IsAuthenticated{get;}
            string Name{get;}
          }
          ```
          
          GenericIdentity: 表示一般用户，用于大多数的自定义登录方案。
          WindowsIdentity
          FormsIdentity: 表示一个使用Forms身份的用户，常用于ASP.NET 应用程序
          PassportIdentity
   .net基于角色的安全，他通过Principal信息来支持授权， 而Principal则由关联的Identity来构造。因此Principal和identity是基于角色的安全中两个核心的概念。
